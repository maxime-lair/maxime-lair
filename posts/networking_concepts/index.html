<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Networking concepts" /><meta name="author" content="Maxime Lair" /><meta property="og:locale" content="en" /><meta name="description" content="In this article, we will try to focus on the layer 2 and 3 of the OSI model." /><meta property="og:description" content="In this article, we will try to focus on the layer 2 and 3 of the OSI model." /><link rel="canonical" href="https://maxime-lair.github.io/maxime-lair/posts/networking_concepts/" /><meta property="og:url" content="https://maxime-lair.github.io/maxime-lair/posts/networking_concepts/" /><meta property="og:site_name" content="Bin/sh" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-11T19:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Networking concepts" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Maxime Lair" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Maxime Lair"},"description":"In this article, we will try to focus on the layer 2 and 3 of the OSI model.","url":"https://maxime-lair.github.io/maxime-lair/posts/networking_concepts/","@type":"BlogPosting","headline":"Networking concepts","dateModified":"2022-02-03T22:43:28+01:00","datePublished":"2022-01-11T19:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://maxime-lair.github.io/maxime-lair/posts/networking_concepts/"},"@context":"https://schema.org"}</script><title>Networking concepts | Bin/sh</title><link rel="apple-touch-icon" sizes="180x180" href="/maxime-lair/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/maxime-lair/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/maxime-lair/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/maxime-lair/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/maxime-lair/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Bin/sh"><meta name="application-name" content="Bin/sh"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/maxime-lair/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/maxime-lair/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/maxime-lair/" alt="avatar" class="mx-auto"> <img src="/maxime-lair/assets/img/favicons/avatar.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/maxime-lair/">Bin/sh</a></div><div class="site-subtitle font-italic">Have fun reading</div></div><ul class="w-100"><li class="nav-item"> <a href="/maxime-lair/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/maxime-lair/roadTo/" class="nav-link"> <i class="fa-fw fas fa-road ml-xl-3 mr-xl-3 unloaded"></i> <span>ROAD TO DEVOPS</span> </a><li class="nav-item"> <a href="/maxime-lair/bin-sh/" class="nav-link"> <i class="fa-fw fas fa-tools ml-xl-3 mr-xl-3 unloaded"></i> <span>BIN-SH</span> </a><li class="nav-item"> <a href="/maxime-lair/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/maxime-lair/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/maxime-lair/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/maxime-lair/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/maxime-lair" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/maxime-lair/"> Home </a> </span> <span>Networking concepts</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Networking concepts</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/maxime-lair">Maxime Lair</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-01-11 19:00:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 11, 2022, 7:00 PM +0100" >Jan 11, 2022</em> </span> <span> Updated <em class="timeago" date="2022-02-03 22:43:28 +0100 " data-toggle="tooltip" data-placement="bottom" title="Thu, Feb 3, 2022, 10:43 PM +0100" >Feb 3, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5980 words"> <em>33 min</em> read</span></div></div></div><div class="post-content"><p>In this article, we will try to focus on the layer 2 and 3 of the OSI model.</p><p>We will try to understand IP v4/v6 works without diving too much into details, and understand how It is routed across networks.</p><p>We could also call it understanding the network layer, as we will cover <em>ARP/ICMP/MAC/LLC</em></p><p>We will however not dive into TCP/UDP specifics, as It would make the article too clustered with informations, and It was already partly covered in the sockets article</p><h2 id="datalink-layer">Datalink layer<a href="#datalink-layer" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This layer transfers data between nodes on a network segment (often <em>Ethernet</em>) across the <em>physical layer</em> (the electronic circuit). It may also detect and possibly correct errors that can occur in the physical layer. It is concerned with the local delivery of <strong>frames</strong>.</p><p>A <strong>frame</strong> do <strong>not</strong> cross the boundaries of a local area network. Inter-network routing and global addressing are higher-layer functions. You could compare the datalink layer to a <a href="https://en.wikipedia.org/wiki/Roundabout">roundabout</a>, It arbitrates parties for access to a medium without concern for their ultimate destination.</p><p><em>Frame collisions</em> occur when devices attempt to simultaneously use the same medium (e.g. a traffic crash). Data-links protocols try to detect, reduce, prevent and recover from such collisions.</p><p>The main protocols are:</p><ul><li>Ethernet<li>Point-to-Point (PPP)<li>HDLC<li>ADCCP</ul><h3 id="ethernet-802xx">Ethernet 802.xx<a href="#ethernet-802xx" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="ieee-802">IEEE 802<a href="#ieee-802" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>Here we will talk about the IEEE 802 local lan networks, with MAC layers such as Ethernet, Token Ring and 802.11 (Wireless Lan).</p><p>The <strong>IEEE 802</strong> is restricted to computer networks carrying variable-size packets, unlike cell relay networks (e.g. ADSL). It is a group of standards for LANs, numbered 802.1 to 802.12, with the most important ones being:</p><div class="table-wrapper"><table><thead><tr><th>Number<th>Description<tbody><tr><td>802.3<td>Ethernet<tr><td>802.8<td>Fiber optic<tr><td>802.11<td>WLAN</table></div><blockquote><p>Note: the number 802 has no significance: it was simply the next number in the sequence that the IEEE used for standards projects.</p></blockquote><p>Over the years, a few numbers were added for specific case, such as <em>802.15</em> for Wireless Personal Area Network (WPAN) and <em>802.15.6</em> for Body Area Network (BAN) used for peacemaker or body implants devices.</p><h4 id="ethernet">Ethernet<a href="#ethernet" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>Ethernet is a family of wired computer networking technologies, and has largely replaced competing wired LAN technologies such as <em>Token Ring</em> or <em>FDDI</em>. It can go up to 400 Gbit/s and is currently developping a 1.6 Tbit/s rate as of 2021.</p><p>Systems communicating over Ethernet divide a stream of data into shorter pieces called <strong>frames</strong>. Each frame contains source and destination addresses and error-checking data. This address is defined as the MAC address and is used by other IEEE 802 networking standards such as 802.8 (FDDI) or 802.11 (Wi-Fi).</p><p>It is the one of the foundation that make up the Internet, as the IP is commonly carried over Ethernet. Most Ethernet devices use twisted-pair cables for the physical layer, as opposed to coaxial cable. While coaxial support greater cable lengths (200+ meters) compared to twisted pair (100 meters maximum), twisted pair is less expensive and allows speed up to 100 Gbps (Depends on cable category, 5 being standard, 8 used in datacentre).</p><p>The ethernet frame:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151184038-c201f7f9-8c27-40a6-900f-910c8983d54b.png" alt="ethernet_frame(1)" data-proofer-ignore></p><p>One notable frame structure of Ethernet frame is having no <em>time-to-live field</em>, which can lead to a switching loop (also known as <strong>broadcast storms</strong>). This can happen If there is more than one layer 2 path between two endpoints (connecting two ports on the same switch to each other), multicasts are then repeatedly forwarded forever, flooding the entire network. We will see how to avoid this in a later section.</p><p>While Ethernet frames are usually 1518 bytes long, they can potentially appear smaller or bigger depending on the system settings. A larger ethernet frame is called <strong>Jumbo frames</strong> and can go up to 9000 bytes long (or you can go further and beyond with <strong>Super jumbo frames</strong> going up to 64000 bytes). If this size is non-uniform to a network node, It will be detected as <strong>Jabber</strong> and subsequently dropped. On the opposite, an Ethernet frame has a minimum size of 64 bytes (18 bytes header and 46 bytes payload), anything smaller is considered <strong>Runt frames</strong> and is subsequently dropped.</p><p>You can probably notice there is multiple types of Ethernet frames, namely the one respecting IEEE 802.3 and Ethernet II. The main difference is IEEE 802.3 uses a LLC header that will be described later. Ethernet II type is largely more used in comparaison.</p><h3 id="wi-fi-80211">Wi-Fi 802.11<a href="#wi-fi-80211" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>While we will not dive too deep into the 802.11 specifications, It is nice to compare it to Ethernet (wired) frames. They have different types of frames (control, management and data), we will just focus on the data frames. They are larger in size, but requires the use of a LLC header in the payload. It always starts with a frame control which contains the options of the wireless connection:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151413155-187b58e3-ea5b-4889-8e4a-d77e6e773b49.png" alt="frame_control_wifi" data-proofer-ignore></p><p>It uses MAC address, like Ethernet, but differ in their header definition:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151413335-08bdd76e-a194-487b-81ea-7b9c057b2ad7.png" alt="wifi_data_frame" data-proofer-ignore></p><p>Notice how similar It is to Ethernet, but allows for a bigger payload, since wireless devices are often battery powered, and they try to reduce the number of frames sent as It makes devices last longer.</p><h3 id="alternatives">Alternatives<a href="#alternatives" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>In the data-link layer, while the IEEE 802 is often used, a few alternatives exist to perform the same function. It often depends on the network hardware used to transmit data on the physical layer.</p><h4 id="point-to-point">Point-to-point<a href="#point-to-point" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p><em>PPP</em> is a data link layer communication protocol between two routers directly without any host or any other networking in between. It was designed to work with numerous network layer protocols such as IP or IPX. <em>PPP</em> is used over many types of physical networks such as phone line, ISDN. Your Internet Service Provider (ISP) could have used <em>PPP</em> to establish a connection through the facilities of the public switched telephone network.</p><p>It can provide <em>authentication</em> through password or challenge handshake, <em>compression</em> and <em>error detection</em>. It is often used whenever you need to tunnel data over IP networks, as a tunnel is by definition a point-to-point connection and PPP is thus a natural choice between the virtual network interfaces. PPP can assign IP addresses to these interfaces that can be used to route between the networks on both sides of the tunnel. These interfaces would be called <strong>tun0</strong> or <strong>ppp0</strong>.</p><p>In case of VPN (e.g. IPSec in tunneling mode), no virtual network interfaces are created, since the tunnel is handled by the transport layer (TCP/IP), and <strong>L2TP</strong> is then used, but here <em>PPP</em> also provides IP addresses to the extremities of the tunnel.</p><h4 id="adccp--hdlc">ADCCP / HDLC<a href="#adccp--hdlc" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>Previously used data link layer protocol which was bit oriented. they are both functionally equivalent, and most currently used protocols in the datalink layer were derived from their specifications. It was progressively less used due to Ethernet popularity.</p><h3 id="llcmac">LLC/MAC<a href="#llcmac" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>The data link layer is often divided into two sublayers:</p><ul><li>Logical link control (LLC)<li>Media access control (MAC)</ul><h4 id="llc">LLC<a href="#llc" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>The uppermost sublayer multiplexes protocols running at the top of the data link layer, It makes it possible for several network protocols to coexist within a multipoint network and to be transported over the same network medium. It also provides addressing and control of the data link. It can be considered as the interface between the network layer and the MAC. In short, the LLC provides a way for the upper layers to deal with any type of <em>MAC</em> layer.</p><p>It can also optionally provide flow control and error management capabilities, but It depends on the protocol stack, as It is usually taken care of by a transport layer such as TCP.</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151045484-ec903706-6599-4495-8cb6-1a8b43ea7bfb.png" alt="LLC_PDU" data-proofer-ignore></p><p>Note the control part can be either 8 or 16 bits long depending on the format (mostly 8 bits). We will not dive into the specifics, as It is rarely a source of bug, as you can see It is mainly to indicate the service access port.</p><p>This unit is then followed by a multiple of 8 bits, containing the <strong>information</strong> of the upper layer data.</p><p>But this model is rarely used in reality, and TCP/ARP frames will not use the SAP value for <em>TCP/ARP</em>, but will use <strong>SNAP</strong> instead. SNAP is an extension of the LLC, by adding 40 bits after the LLC header. SNAP supports identifying protocols by Ethernet type field values (<strong>Ethertypes</strong>); it also supports vendor-private protocol identifier spaces instead of being limited to the 7-bit identifying code.</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151050049-090f681a-2668-4304-b7fe-a0aad2299ea6.png" alt="LLC_PDU_SNAP(1)" data-proofer-ignore></p><p>If the OUI value is <em>zero</em>, the protocol ID is the registered <a href="https://en.wikipedia.org/wiki/EtherType"><em>EtherType</em></a></p><p>An EtherType field in each frame is used by the operating system on the receiving station to select the appropriate protocol module (e.g., an Internet Protocol version such as IPv4). Ethernet frames are said to be self-identifying, because of the EtherType field. Self-identifying frames make it possible to intermix multiple protocols on the same physical network and allow a single computer to use multiple protocols together.</p><p>This is why, on Ethernet 802.3, the 8 octets (3 from <em>LLC</em>, 5 from <em>SNAP</em>) reduce the size of the available payload such as IP to 1492 bytes (from the default MTU 1500). Therefore, with protocols that have EtherType values, packets are usually transmitted with Ethernet II headers rather than with LLC and SNAP headers, but on other network types, the LLC and SNAP headers are required in order to multiplex different protocols on the link layer, as the MAC layer doesn’t possess an EtherType field, so there’s no alternative framing that would have a larger available payload.</p><p>For example, IP datagrams and ARP datagrams are transmitted over IEEE 802 networks using LLC and SNAP headers. But in reality, this specification is rarely followed, and most Ethernet frame will use <strong>Ethernet II</strong>, which include the Ethertype directly into the header, without any need for extension.</p><p>Ethernet II framing vs Ethernet 802.3 framing:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151205372-e738a943-2a05-4f3d-b302-f3766f5c1412.png" alt="ethernet_II_frame(1)" data-proofer-ignore></p><p>You can see how using Ethernet 802.3 frames reduce the payload size by the LLC+SNAP header, and overcomplicate things. This is why Ethernet II is here to stay, as It is less complicated and allow for a bigger payload. This also explains why <strong>Etherfield</strong> values are always over 1500 bytes in value. That value was chosen because the maximum length of the payload field of an Ethernet 802.3 frame is 1500 octets (0x05DC). Thus if the field’s value is greater than or equal to 1536, the frame must be an Ethernet II frame, with that field being a type field. If it’s less than or equal to 1500, it must be an IEEE 802.3 frame, with that field being a length field. Values between 1500 and 1536, exclusive, are undefined. This convention allows the coexistence of both standards on the same physical medium.</p><h3 id="mac-layer">MAC layer<a href="#mac-layer" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Also called the medium access control sublayer, It controls the hardware responsible for interaction with the transmission medium (wired, optical or wireless). While the LLC provides flow control and multiplexing for the logical link (EtherType, etc.), the MAC provides flow control and multiplexing for the transmission medium.</p><h4 id="mac-access-methods">MAC access methods<a href="#mac-access-methods" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>In Ethernet, bit errors are very rare in wired networks, receiving incorrect packets will simply be detected and dropped, but not retransmitted (It will expect higher layer to do it). The collision detection is these case is handled by <em>CSMA/CD</em>, <em>CD</em> meaning Collision detection.</p><p>In Wireless communications, bit errors are very common, but the flow control and error management is handled by the MAC layer through <em>CSMA/CA</em>, <em>CA</em> meaning Collision Avoidance.</p><h4 id="mac-addressing">MAC addressing<a href="#mac-addressing" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>It includes a local network address called MAC address, intended to be a unique serial number assigned by the network interface hardware (NIC) at the time of manufacture. It is 48 bits long, separated by colons every two digits</p><p>An example, this one belongs to <em>Samsung Electronics</em>:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151060330-1d0d3833-c5c9-450d-882c-3c7f4aa9394d.png" alt="MAC_48(3)" data-proofer-ignore></p><p>a MAC address can be defined universally by the manufacturer or locally by a system administrator. MAC address are by definition finite and we will end up running out of possible addresses, so an alternative called <strong>EUI</strong> was created. It simply adds 2 octets to the <em>UAA</em>, all <em>MAC-48</em> are <em>EUI</em> by padding <code class="language-plaintext highlighter-rouge">FF:FF</code> between your OUI and UAA.</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151061413-784317f2-a632-4169-9881-88ab246ef8f7.png" alt="EUI_64" data-proofer-ignore></p><p>Ethernet frames with a value of 1 in the least-significant bit of the first octet of the destination MAC address are treated as multicast frames and are flooded to all points on the network.</p><p>Some blocks are reserved to specific usage, such as PTP (Time precision protocol) or STP (Spanning tree protocol), you can check them <a href="https://en.wikipedia.org/wiki/Multicast_address">here</a>. These blocks are either only on Local LAN link or either be forwarded through bridges.</p><p>Easier to understand with an example:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151064299-bdeaeebd-e5b0-4965-be16-90067188e9d8.png" alt="MAC_48_multicast" data-proofer-ignore></p><p>The MAC protocol is used to provide the data link layer of the communication protocol (e.g. Ethernet), and its header include 16 bytes with a CRC at the end:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151067888-427a5afe-daac-4e1b-bd4e-2210a75ab487.png" alt="MAC_header" data-proofer-ignore></p><h4 id="quality-of-service-control">Quality of service control<a href="#quality-of-service-control" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>Also called <em>Audio Video Bridging (AVB)</em>, It provides a set of technical standard to improve synchronization, low-latency and reliability for switched Ethernet networks. It is particulary useful in QoS applications requiring low <a href="https://en.wikipedia.org/wiki/Jitter">jitter</a> such as voIP and IPTV. This QoS is often implemented on the network/transport layer, but there is a few enhancements available on the datalink layer to implement it. These enhancements make use of the optional VLAN tag to implement priority values on data frames.</p><h4 id="vlans">VLANs<a href="#vlans" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>A virtual LAN is any broadcast domain that is partitioned and isolated in a network at the data link layer. It works by applying tags to network frames to create the appearance and functionality of network traffic that is physically on a single network but acts as If It is split between separate networks. VLANs allow admins to group hosts together even if the hosts are not directly connected to the same network switch, greatly simplifying network design and deployment (less cables/devices).</p><p>An ethernet frame with a VLAN value is usually defined as <strong>tagged</strong>, and without the optional VLAN header, It is <strong>untagged</strong>. An Ethernet switch can decide to drop or forward tagged frames depending on its configuration (access or trunk mode, VLANs allowed, etc.).</p><p>This feature is one of the most used in modern networks, as you can scale multiple virtual switches inside one physical switch. Admins will use it to separate and isolate services, making the subnet size smaller (less broadcast noises) and more secure (easier to apply IPS/IDS/ACLs). Cloud providers are particulary fond of VLAN, as you can more easily scale your growing infrastructure.</p><h3 id="switchbridgewap">Switch/Bridge/WAP<a href="#switchbridgewap" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Speaking of VLANs direct us to the subject of Ethernet switch and bridges, and how they operate on the datalink layer.</p><p>Let’s start off with a <em>hub</em>, which is a network device without any logic implemented, It simply waits to receive incoming packets to blast it out on all other ports. It will cause network congestion due to the increased overhead and lots of Ethernet collisions (e.g. 6 hosts sending one packet each to a hub would result in creating 30 packets total on the network). This helps to understand why network devices need to implement some kind of logic to route packets efficiently.</p><p>The first network device to implement this logic on the datalink layer is the <strong>Ethernet switch</strong>. It uses the <em>MAC</em> destination address to forward a frame to the port associated with that address. Addresses are automatically learned by looking at the MAC source address on received frames. If a MAC address is unknown, It will simply flood the frame out to all its port but the ingress port, which will simply refresh its MAC address table.</p><p>A switch is stateless, so It has no memory on who requested which data, It does not operate on any upper layer protocols (IP, TCP, HTTP, etc.), It simply learn source addresses and forward by destination address. If you need to capture frames going from one port to another on a switch, you would use SPAN (i.e. port mirroring). However, this setup is limited and impacts your switch CPU. In reality people would prefer adding a network TAP (Terminal Access Point), which is a hardware device similar to a hub, but with 2 ports (port A and B) and a monitor port. They are non-obtrusive (they do not impact your ethernet switch), not detectable on the network, but usually come at a cost.</p><p>Now, if you understood what an ethernet switch is, you already know what an ethernet bridge is. The difference is simple, an ethernet switch is a <strong>multiport</strong> ethernet bridge. It simply relays Ethernet frames between devices connected to different ports, in bridge case, It would only be between two devices. Today, the term bridge and switch pretty much mean the same thing.</p><p>Historically, <em>switches</em> were a term used for devices working on the datalink layer, but It merged overtime with the term <em>router</em>, usually used for the network layer. <em>Router</em> includes the logic of the <em>Internet Protocol</em> which will be explained later, but this made switches capable of performing <em>ARP</em> requests to update its MAC address table. While switches were already sensitive to <strong>MAC flooding</strong> attacks, this also made them vulnerable to <strong>ARP spoofing</strong>.</p><p>As your network size grows, the number of switches (physical or virtual) goes up, up to thousands of bridges in some case. In order to provide the best route between two nodes, two features to be added onto an Ethernet switch:</p><ul><li>Redundancy (through STP)<li>Load-balancing (through SPB)</ul><p>LANs have traditionally relied on Spanning Tree Protocol (<em>STP</em>) and its variants (RSTP/MSTP) to prevent loop on the L2 layer. This topology is achieved by electring a <em>root bridge</em> and building a least-cost tree linking the root bridge with other non-root nodes. This least-cost tree is created by disabling all links which are not in the least-cost path towards the root. By being able to create a tree-like topology, we can also add more switches for redundancy without being threatened by a layer-2 loop.</p><p>While It prevents loop by forcing the path through the root bridge, It makes many links to remain unused, forcing sub-optimal paths. It showcases the limits of Ethernet networks, where all nodes in the LAN have to learn all end-device MAC addresses by flooding until the destination address is learned.</p><p>For example, imagine this topology:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151243176-dea12bef-0228-4c1b-ac11-b3875452750c.png" alt="STP_path_first" data-proofer-ignore></p><p>The forced path would be the least-cost ones going through the root bridge:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151243251-4fbd2287-0a9a-43c7-8344-ecdd00d950c5.png" alt="STP_path(1)" data-proofer-ignore></p><p>But It is not using all possibles paths, specially a potentially more efficient one:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151243293-658cdb61-a95e-4cae-8c8e-063567ca7a7b.png" alt="STP_path_best" data-proofer-ignore></p><p><em>SPB</em> stands for Shortest Path Bridging, replacing older spanning tree protocols that blocked any redundant paths that could result in a broadcast storm. <em>SPB</em> allows all paths to be active with multiple equal cost paths, providing much larger layer 2 topologies, improving the efficiency by allowing traffic to load share across all paths of a mesh network. It is designed to virtually eliminate human error during configuration (<a href="https://www.reddit.com/r/networking/comments/qmbyql/hpe_layer_2_multicast_nightmare/">which still happens today</a>) and preserves the plug-and-play nature that established Ethernet as the de facto protocol at layer 2. It started being used since ~ 2014 (e.g. at the Winter Olympics).</p><p>A nice gif from wikipedia showcasing the algorithm:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151229356-a1b45460-393f-4cdb-8d31-51c5ab85451f.gif" alt="650px-802d1aqECMP16_(cropped)" data-proofer-ignore></p><h2 id="network-layer">Network layer<a href="#network-layer" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now that we have understood how the data link layer is applied, we can move on onto the network layer. It is responsible for packet forwarding including routing through intermediate routers.</p><p>It is connectionless, a data packet can travel from a sender to a recipient without the need for an acknowledgement. Also, every host on the network must have a unique address that determines where it is. Networks also need to be able to forward message to other networks for wide-area communication, with the help of gateways or routers.</p><p>The main protocol of this layer is <strong>Internet Protocol</strong> or IP. It has the task of delivering packets from the source host to the destination host solely on the IP addresses in the packet headers. It is by definition an unreliable protocol, as It only ensures delivery on a best-effort basis, It does not guarantee that data will be delivered.</p><h3 id="ipv4">IPv4<a href="#ipv4" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Similar to the logic in other OSI layers, an IP packet consists of a header section followed by the data It encapsulates. One difference could be that It does not add a footer, so there is no data checksum for the packet, It is usually fine as the data link layer, through the <em>CRC</em> of Ethernet or <em>FCS</em> of 802.11 WLAN, can already detects most errors, and higher layers also adds data checksum (e.g. <strong>TCP</strong> for the transport layer).</p><p>An IPv4 header format looks like this:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151434788-47602a1a-2fdc-4788-b472-127bc045f0c3.png" alt="IP_header(1)" data-proofer-ignore></p><p>You can easily deduce from the different section that IPv4 is mainly used for encapsulating the higher layer, while allowing fragmentation and routing.</p><h4 id="ipv4-address">IPv4 address<a href="#ipv4-address" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>The IP address space is 32-bit, allowing for 4 billions unique addresses, It is managed by the IANA and the regional Internet Registries (RIP NCC for Europe, ARIN for America). Each RIR maintains a publicly searchable <code class="language-plaintext highlighter-rouge">whois</code> database that provides information about IP address assignments.</p><p>For example, on a random European IP address:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151251803-5708c6de-d8d8-45e6-a244-486c51c81842.png" alt="image" data-proofer-ignore></p><p>You can notice the IP is part of an address range, as those registries do not allocate IP one by one but block by block. Each block can be defined with a <strong>CIDR notation</strong>, which combines the address of its routing prefix in a compact format, in which the address is followed by a slash character (/) and the subnet mask.</p><p>Let’s say you wish to use 16 IP addresses in your network, you need to know two parts : your network identifier and the host identifier. This is done through a mask.</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151257012-f34fd8d8-8a11-42a0-a3c0-a77fedb32a71.png" alt="mask" data-proofer-ignore></p><p>Here, the network identifier would be 192.168.31.128 (chosen randomly), and the IP block 192.168.31.128 - 192.168.31.143 ; notice how there is only 14 available address in the range, as the first one is network address, and the last one is the broadcast address. In CIDR notation, the mask would be <em>/28</em> as there are 28 binary values that identify the network identifier. In reality, there would only be 13 available addresses, as you would need to count the gateway to route outside your network.</p><p>A few address block are reserved for special use, notably <em>127.0.0.0/8</em> for loopback addresses, <em>10.0.0.0/8</em> for local communication in VPNs or <em>224.0.0.0/4</em> for IP multicast. There is also <strong>three private networks block</strong> available, packets addresses in these ranges are not routable in the public Internet. These private hosts are notably used for desktop systems :</p><div class="table-wrapper"><table><thead><tr><th>CIDR block<th>Address range<th>Number of addresses<tbody><tr><td>10.0.0.0/8<td>10.0.0.0 - 10.255.255.255<td>16 777 216<tr><td>172.16.0.0/12<td>172.16.0.0 - 172.31.255.255<td>1 048 576<tr><td>192.168.0.0/16<td>192.168.0.0 - 192.168.255.255<td>65 536</table></div><h4 id="fragmentation-and-reassembly">Fragmentation and reassembly<a href="#fragmentation-and-reassembly" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>The IP enables traffic between networks who are usually of diverse physical nature (no one has the same hardware), harnessing different transmission speed and <em>MTU</em>. When one network wants to transmit datagrams to a network with a smaller PDU, It may need to fragment its datagrams. This is done on the network layer by IPv4 routers.</p><p>This is only possible if a packet allows itself to be fragmented, as seen on the IPv4 flags header. At each fragmentation, 4 elements will require to be changed : <em>length</em>, <em>flag</em>, <em>fragment offset</em> and <em>header checksum</em>. One interesting feature is the possibility of fragmented packet to be re-fragmented thanks to the fragment offset being a 8-byte blocks multiple.</p><p>For example, imagine sending a 3320 bytes packet through this topology with different MTUs:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151445118-80ad73a7-43f4-4aaf-934c-5a510ae47dfc.png" alt="IP_fragment(1)" data-proofer-ignore></p><p>While this depend on some configuration, most routers will not re-assemble even if the sum of two fragments are under the MTU, and It will only be done once the packet arrives onto its destination.</p><h4 id="arp">ARP<a href="#arp" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>Now that we understand how IPv4 addressing and fragmentation works, we can try to understand how IPv4 address are linked to their lower layer address such as MAC. This specific resolution is done through <strong>ARP</strong> which is <em>address resolution protocol</em>. Since this protocol resolves layer 3 addresses with layer 2 addresses, It can be considered a link and network layer protocol.</p><p>The protocol uses a simple message format containing one address resolution request or response. The following example would be for IPv4 over Ethernet ARP packet, since hardware type (MAC) is 48 bits and protocol address (IPv4) is 16 bits. All systems retain an ARP cache table to avoid re-doing this request everytime.</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151448359-5db68f38-9ffd-42ec-9871-13e46511d095.png" alt="ARP_packet" data-proofer-ignore></p><p><em>ARP</em> can also be used as an announcement protocol where a host can periodically broadcast a <em>gratuitous ARP (GARP)</em> message to announce its IP or MAC address change. It is usually done at startup, but will avoid flooding the network with those requests, as It could be considered ARP spoofing by malicious hosts.</p><h3 id="ipv6">IPv6<a href="#ipv6" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>IPv6 is the most recent version of the Internet protocol. It was developped to deal with the long-anticipated issue of IPv4 address exhaustion. 4 billions devices is not a lot considering the world population and growing appetite for electronic devices such as smartphones. Today, <a href="https://www.google.com/intl/en/ipv6/statistics.html#tab=per-country-ipv6-adoption">IPv6 deployment</a> is largely popular in higher population countries such as China or India, but most countries still largely use IPv4 in comparaison. It is deemed to be changed over the next few decades, as China announced plans to complete a national IPv6 rollout by 2030.</p><p>In IPv6, devices are assigned a unique IP address for identification <strong>and location definition</strong>. IPv6 uses <strong>128-bit addresses</strong>, allowing around the same number of atoms available on Earth (e.g. pratically infinite).</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151451939-ce4e0074-e827-4825-9abe-5925e4979d9a.png" alt="ipv6(1)" data-proofer-ignore></p><p><em>IPv6</em> has a minimum packet size of 1280 bytes, consisting of 40-byte base header and 1240 bytes of payload.</p><p><em>IPv6</em> does not fragment its packets, as It uses Path MTU Discovery protocol to determine the network path between two hosts, this protocol is simply about activating the DF flag in IP header and record its path.</p><p>A few address types exist :</p><div class="table-wrapper"><table><thead><tr><th>Address type<th>Sub-type<th>Description<th>Example<tbody><tr><td>Unicast<td>Global Unique address<td>Globally reachable by any host<td>2001:581:f3d1:241f::/64<tr><td>Unicast<td>Link-local<td>Required on every interface, but packets cannot leave or enter the interface<td>fe80::/10<tr><td>Unicast<td>Loopback<td>Same as 127.0.0.1/8 in IPv4<td>::1/128<tr><td>Unicast<td>Unique local addresses<td>Equivalent to IPv4 private ranges<td>fc00::/7<tr><td>Multicast<td> <td>Used to send a packet from one to many (always start with <em>ff</em>)<td>ff00::/8<tr><td>Anycast<td> <td>Used to send a packet from one to a group but only send to the first least expensive destination<td> </table></div><h4 id="ndp">NDP<a href="#ndp" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>It shares the same function as ARP in IPv4. It uses five ICMPv6 packet types for the purpose of :</p><ul><li>Router solicitation<li>Router advertisement<li>Neighbor solicitation<li>Neighbor advertisement<li>Redirect</ul><p>I will not describe the details, as we just to know It reproduces ARP function for MAC address resolution on IPv6.</p><h3 id="icmp">ICMP<a href="#icmp" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>It is used by network devices to send error messages and operational information indicating success or failure when communicating with another IP address. It is always encapsulated in an IPv4 packet, so It is part of the transport layer.</p><p>For example, every device forwarding an IP datagram first decrements the TTL field in the IP header by one. If the resulting TTL is 0, the packet is discarded and an ICMP <em>time exceeded in transit</em> message is sent to the datagram’s source address. This is what the command <em>traceroute</em> essentially does.</p><p>A header format is defined as such:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151454652-f09b788f-18bb-4ea1-b8c2-a446cb1b04c6.png" alt="ICMP_packet" data-proofer-ignore></p><p>ICMP error messages contain a data section that includes a copy of the entire IPv4 header, plus the first eight bytes of data from the IPv4 packet that caused the error message. It can go up to 576 bytes in length.</p><p>A few examples of control messages types:</p><div class="table-wrapper"><table><thead><tr><th>Type value<th>Type<th>Subtype (code)<th>Description<tbody><tr><td>0<td>Echo reply<td>0<td>Used to ping<tr><td>3<td>Destination unreachable<td>0 to 15<td>Indicates the routing reason<tr><td>4<td>Redirect message<td>0 to 3<td>Used for ToS or by network &amp; host<tr><td>11<td>Time exceeded<td>0 to 1<td>Reassembly or TTL expiration<tr><td>12<td>Bad IP header<td>0 to 2<td>Missing parameter or option, wrong computation in IPv4 header</table></div><p>Some routers do not allow ICMP message to pass through due to security reason as It can be used to probe your network, but It is most often used for debugging and troubleshooting reason.</p><h3 id="nat--masquerade">Nat / Masquerade<a href="#nat--masquerade" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><strong>Network address ranslation (NAT)</strong> is a method of mapping an IP address space into another by modifying network address information in the IP header of the packets while they are in transit across a traffic routing device.</p><p>It has become an essential tool in conserving global address space in the face of IPv4 address exhaustion. In fact, one Internet-routable IP address of a NAT gateway can be used for an entire private network.</p><p>There is two types of NAT operations:</p><ul><li>Destination-based (<strong>DNAT</strong>)<li>Source-based (<strong>SNAT</strong>)</ul><blockquote><p>:triangular_flag_on_post: For some vendors, <em>SNAT</em> can also mean <em>stateful</em> (e.g. Cisco) or <em>secure</em> (e.g. F5 Networks or Microsoft)</p></blockquote><h4 id="dnat">DNAT<a href="#dnat" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p><em>Destination network address translation</em> is a technique for transparently changing the <em>destination</em> IP address of a routed packet and performing the inverse function for any replies. Any router situated between two endpoints can perform this transformation, and It is commonly used to publish a service located in a private network on a publicly accessible IP address. This use is also called <strong>port forwarding</strong> or <strong>DMZ</strong> when used on an entire server. If you wish to protect your server behind a firewall, this is a needed feature.</p><h4 id="snat">SNAT<a href="#snat" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>Also called <em>One-to-Many NAT</em>, It is a technique used for transparently changing the <em>source</em> IP address of a routed packet and performing the inverse function for any replies. The majority of network address translators map multiple private hosts to one publicly exposed IP address. The way It works is a router in that network has a private address of that address space. The router is also connected to the Internet with a public address.</p><p>As traffic passes from the local network to the Internet, the source address in each packet is translated on the fly from a private address to the public address. The router tracks basic data about each active connection (particularly the destination address and port). When a reply returns to the router, it uses the connection tracking data it stored during the outbound phase to determine the private address on the internal network to which to forward the reply.</p><p>To logic works well for <em>one-to-one</em> conversion, but in order to map multiple address (<em>one-to-many</em>), a feature called <strong>masquerade</strong> is needed. It allows all of the hosts on a private network to use the Internet at the price of a single IP address. The word <em>masquerade</em> comes from a party or dance where people wear masks, and It pretty much defines the logic behind it.</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151639841-94e3b058-4552-42eb-9140-542896e1d626.png" alt="masquerade_nat(1)" data-proofer-ignore></p><p>Using <strong>Masquerade</strong> today is a must, as It also forbid external network to access any of your private network since none of the hosts on the supported network behind the router are ever directly seen, and lays the foundation for applying security measures to your private hosts. It comes at a cost, since It requires CPU ressources for the translation and forbid you from hosting services relying on incoming sessions to work (such as FTP).</p><h3 id="ospf">OSPF<a href="#ospf" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>To end the presentation of the network layer, we can talk about the <strong>Open Shortest Path First (OSPF)</strong> routing protocol used for IP networks. It is widely used in large enterprise networks and large service provider as the de-facto protocol in a single routing domain. It is part of <em>Interior gateway protocol (IGP)</em>, alternatives are <em>RIP</em> or <em>IS-IS</em>.</p><p>It gathers link state information from available routers and constructs a topology map of the network. The topology is then used to routes packets based solely on their destination IP address. <em>OSPF</em> detects changes, such as link failures, and converges on a new <em>loop-free</em> routing structure within seconds. It computes the shortest-path tree for each route based on <a href="https://clementmihailescu.github.io/Pathfinding-Visualizer/#">Dijkstra’s algorithm</a>.</p><p><em>OSPF</em> uses <em>multicast</em> addressing for distributing route information within a broadcast domain to all IP routers but without traversing them.</p><p>You can try it out <a href="https://topolograph.com/">here</a>, for example:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151634796-8dc1c35a-c0d2-429d-a6c2-ddfeaa8cb838.png" alt="image" data-proofer-ignore></p><h2 id="useful-commands-and-utilities">Useful commands and utilities<a href="#useful-commands-and-utilities" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>I will be using a <em>CentOS 9 Stream</em> which came out in late 2021, some commands might differ depending on the Linux distribution you use, but the way It works will remain mostly the same.</p><h3 id="ip-command">IP command<a href="#ip-command" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Your main tool out of the box will be the <code class="language-plaintext highlighter-rouge">ip</code> command, It is a recent command, and people often still uses <code class="language-plaintext highlighter-rouge">ifconfig</code> instead. <code class="language-plaintext highlighter-rouge">ip</code> utility regroups many tools into one single command, such as <code class="language-plaintext highlighter-rouge">arp</code>, <code class="language-plaintext highlighter-rouge">route</code>, <code class="language-plaintext highlighter-rouge">ifconfig</code>, <code class="language-plaintext highlighter-rouge">netstat</code>. If you use it in scripts, make sure the command is installed !</p><p>I created some hosts in a private LAN, and have them able to access the Internet, <strong>check out the PFSense article for more details</strong></p><p>First, let’s show our network interface with <code class="language-plaintext highlighter-rouge">ip link</code></p><p><img data-src="https://user-images.githubusercontent.com/72258375/151658037-0e7a54b9-0131-4b49-8902-f197162de17a.png" alt="image" data-proofer-ignore></p><p>We could even print statistics on their use with the <code class="language-plaintext highlighter-rouge">-s</code> argument:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151658067-b481edee-5a83-43db-8f36-88e7cd36e905.png" alt="image" data-proofer-ignore></p><p>This command will show you the <strong>linklayer</strong> interfaces, and thus only the MAC addresses for each device, they show you the main characterics, which is mainly about :</p><ul><li>Device enabled and connected (e.g. <em>UP</em> and <em>LOWER_UP</em> respectively)<li>The device capability (<em>BROADCAST</em>, <em>MULTICAST</em>)<li>Available MTU (notice the loopback higher MTU as It is in memory only, <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=0cf833aefaa85bbfce3ff70485e5534e09254773">this value was bumped up in 2012</a>)<li>Some QoS values<li>the assigned MAC value and its broadcast</ul><p>We can even use it to bring our device down with <code class="language-plaintext highlighter-rouge">ip link set &lt;interface&gt; up/down</code></p><p><img data-src="https://user-images.githubusercontent.com/72258375/151658366-375f6c6c-bec3-434b-a65c-a1454bdf1683.png" alt="image" data-proofer-ignore></p><p>But It requires sudo-access since It could potentially impact others users.</p><p>Now, let’s move onto the network layer, and show our IP address with <code class="language-plaintext highlighter-rouge">ip address</code></p><p><img data-src="https://user-images.githubusercontent.com/72258375/151658443-72844697-e78e-49ef-8ce2-73268e8c2589.png" alt="image" data-proofer-ignore></p><p>Notice how the command returns the linklayer informations, and then an IPv4 and IPv6 address. You can see the loopback address being <code class="language-plaintext highlighter-rouge">127.0.0.1/8</code> and <code class="language-plaintext highlighter-rouge">::1/128</code>, but more interestingly, the <em>ens32</em> device has a private IPv4 address (private block <em>10.x.x.x</em>) and link-local IPv6 address (starts with <em>fe80::</em>).</p><p>The utility also allows us to check the multicast address available with <code class="language-plaintext highlighter-rouge">ip maddr</code>:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151658590-6641006d-9958-45bb-9f42-083d6c380734.png" alt="image" data-proofer-ignore></p><p>And our local ARP table with <code class="language-plaintext highlighter-rouge">ip neigh</code>, which is empty at first, but get filled as we start discussing with others hosts on LAN:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151658655-5cbb6651-59ac-495c-8a35-2c9266156e8e.png" alt="image" data-proofer-ignore></p><p>The command <code class="language-plaintext highlighter-rouge">ip route</code> can also be used to print our routing table, used by our host to route <em>packets</em> on the network:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151658687-53b68286-98ec-46cc-83bc-5c159c4c7ca6.png" alt="image" data-proofer-ignore></p><p>Here you can see two simple rule which says:</p><ul><li>route everything by default to our gateway located on <em>10.0.0.1</em> through <em>ens32</em> network interface<li>Anything directed onto the private IP block <em>10.0.0.0/24</em> can be reached on device <em>ens32</em> with IPv4 source address <em>10.0.0.2</em></ul><p>These rules are applied from the top and then goes down, and If It doesn’t match any rule, It simply get dropped. You can notice that since the default rule is first, the second one will never be applied.</p><p>While this is not dependent on the layer 2 or 3, you can also use <code class="language-plaintext highlighter-rouge">ss</code> to show your host services open to the network</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151659567-21717c02-f969-4e75-84a7-0c2f2715d5b6.png" alt="image" data-proofer-ignore></p><h3 id="etc">/etc<a href="#etc" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Most networks configuration are located in <code class="language-plaintext highlighter-rouge">/etc</code>, but the exact files are not always the same depending on your distribution.</p><p>One of the most common interface file is <code class="language-plaintext highlighter-rouge">/etc/sysconfig/network-scripts/</code> but here mine is empty:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151659772-7cd675d9-8bd0-4eb9-8ca3-734fe184bd5f.png" alt="image" data-proofer-ignore></p><p>But I can definitely see some network interfaces defined in <code class="language-plaintext highlighter-rouge">/etc/networks</code></p><p><img data-src="https://user-images.githubusercontent.com/72258375/151659791-19031c83-9a74-46c2-aa0c-93117ce8d8d9.png" alt="image" data-proofer-ignore></p><p>In my distribution, those settings are done through <em>NetworkManager</em> and located in <code class="language-plaintext highlighter-rouge">/etc/NetworkManager/system-connections</code></p><p><img data-src="https://user-images.githubusercontent.com/72258375/151659889-bc11dc37-ade5-4bd4-badd-52f33e18c8cf.png" alt="image" data-proofer-ignore></p><p>You can use <code class="language-plaintext highlighter-rouge">nmcli</code> to interact with it</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151659932-8e4d1699-4c35-4761-9ed3-6283fdcd50dd.png" alt="image" data-proofer-ignore></p><h3 id="proc">/proc<a href="#proc" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>A lot of informations about your configuration can also be accessed directly onto <code class="language-plaintext highlighter-rouge">/proc/net</code></p><p><img data-src="https://user-images.githubusercontent.com/72258375/151660038-74348219-4053-4e2d-a705-d2b5e99f5716.png" alt="image" data-proofer-ignore></p><p>You focus on accessing process specific statistics, such as the ARP_cache:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151660129-91236562-899f-407f-acca-355da1bb481b.png" alt="image" data-proofer-ignore></p><h3 id="sys">/sys<a href="#sys" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>You can also access the <code class="language-plaintext highlighter-rouge">/sys</code> directory for more device related informations, a simple search can help us where to look for:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151660259-aa5d1c04-5633-4ba7-b9d5-0cd9f1c6925f.png" alt="image" data-proofer-ignore></p><p>Which allows us to check <em>ens32</em> configuration:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151660285-d9cd4f57-5df3-4c29-b1d7-36605885c419.png" alt="image" data-proofer-ignore></p><p>Which was a symbolic link to our hardware device definition:</p><p><img data-src="https://user-images.githubusercontent.com/72258375/151660341-0708cf9c-a942-4343-bff6-1d9c475c57a3.png" alt="image" data-proofer-ignore></p><h2 id="conclusion">Conclusion<a href="#conclusion" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>We have seen how the linklayer uses frame to transport data across a physical medium, and how It encapsulates its data thanks to MAC addressing. This allows the network layer to use IP for fragmentation and global addressing on a wider variety of networks. While IPv4 and IPv6 can be different in the way they work, they share the same idea of providing a unique address for a device across the globe. A lot was to cover, between ethernet/wifi frames, IP addresses and its link to MAC through ARP, and how NAT try to cover the problem of IP exhaustion. A few commands allows you to handle this on your host, and they are usually vital for people to learn whenever they create a new host, as they are your gateway to the entire Internet.</p><p>Not everything was explained, and if you wish to focus your attention on a specific subject, check out the links below for more information.</p><blockquote><p>Credits</p><p>https://en.wikipedia.org/wiki/Subnetwork_Access_Protocol</p><p>https://networkengineering.stackexchange.com/questions/732/introductory-level-explanation-of-vlans</p><p>https://www.al-enterprise.com/-/media/assets/internet/documents/spb-architecture-tech-brief-en.pdf</p><p>https://www.redhat.com/sysadmin/what-you-need-know-about-ipv6</p><p>https://www.oreilly.com/openbook/linag2/book/ch11.html</p><p>https://access.redhat.com/sites/default/files/attachments/rh_ip_command_cheatsheet_1214_jcs_print.pdf</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/maxime-lair/categories/roadto/'>RoadTo</a>, <a href='/maxime-lair/categories/os-concepts/'>OS Concepts</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/maxime-lair/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/maxime-lair/tags/network/" class="post-tag no-text-decoration" >network</a> <a href="/maxime-lair/tags/linklayer/" class="post-tag no-text-decoration" >linklayer</a> <a href="/maxime-lair/tags/ip/" class="post-tag no-text-decoration" >ip</a> <a href="/maxime-lair/tags/mac/" class="post-tag no-text-decoration" >mac</a> <a href="/maxime-lair/tags/ethernet/" class="post-tag no-text-decoration" >ethernet</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Networking concepts - Bin/sh&url=https://maxime-lair.github.io/maxime-lair/posts/networking_concepts/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/maxime-lair/posts/sockets/">Sockets</a><li><a href="/maxime-lair/posts/networking_concepts/">Networking concepts</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/maxime-lair/tags/linux/">linux</a> <a class="post-tag" href="/maxime-lair/tags/bash/">bash</a> <a class="post-tag" href="/maxime-lair/tags/initd/">initd</a> <a class="post-tag" href="/maxime-lair/tags/network/">network</a> <a class="post-tag" href="/maxime-lair/tags/bus/">bus</a> <a class="post-tag" href="/maxime-lair/tags/cadvisor/">cadvisor</a> <a class="post-tag" href="/maxime-lair/tags/concurrency/">concurrency</a> <a class="post-tag" href="/maxime-lair/tags/container/">container</a> <a class="post-tag" href="/maxime-lair/tags/device/">device</a> <a class="post-tag" href="/maxime-lair/tags/docker/">docker</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/maxime-lair/posts/pfsense/"><div class="card-body"> <em class="timeago small" date="2021-12-28 19:00:00 +0100" >Dec 28, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PFSense</h3><div class="text-muted small"><p> First, It can help, to change keyboard layout in PFSense (will reset at next reboot) kbdcontrol -l /usr/share/syscons/keymaps/[YOUR LOCALE LANGUAGE].iso.kbd WAN/LAN configuration WAN is the wide ...</p></div></div></a></div><div class="card"> <a href="/maxime-lair/posts/memory_and_storage/"><div class="card-body"> <em class="timeago small" date="2022-01-03 19:00:00 +0100" >Jan 3, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Memory and storage</h3><div class="text-muted small"><p> In this article, we will take a look at how memory and storage interact in Linux, the different technology available, and their perks and defaults Note: Im running a CentOS9 Stream in this article...</p></div></div></a></div><div class="card"> <a href="/maxime-lair/posts/io_management/"><div class="card-body"> <em class="timeago small" date="2022-01-04 19:00:00 +0100" >Jan 4, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IO management</h3><div class="text-muted small"><p> In/Out management on Linux allows us to understand how data flows in Linux, from information coming from the network card, to the hard-drive, passing by CPU, RAM or others devices. All systems wil...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/maxime-lair/posts/sockets/" class="btn btn-outline-primary" prompt="Older"><p>Sockets</p></a> <a href="/maxime-lair/posts/bash_scripting/" class="btn btn-outline-primary" prompt="Newer"><p>Bash scripting</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/maxime-lair">Maxime Lair</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/maxime-lair/tags/linux/">linux</a> <a class="post-tag" href="/maxime-lair/tags/bash/">bash</a> <a class="post-tag" href="/maxime-lair/tags/initd/">initd</a> <a class="post-tag" href="/maxime-lair/tags/network/">network</a> <a class="post-tag" href="/maxime-lair/tags/bus/">bus</a> <a class="post-tag" href="/maxime-lair/tags/cadvisor/">cadvisor</a> <a class="post-tag" href="/maxime-lair/tags/concurrency/">concurrency</a> <a class="post-tag" href="/maxime-lair/tags/container/">container</a> <a class="post-tag" href="/maxime-lair/tags/device/">device</a> <a class="post-tag" href="/maxime-lair/tags/docker/">docker</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/maxime-lair/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/maxime-lair/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/maxime-lair/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
